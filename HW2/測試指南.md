# Mini-Python 測試指南

## 作業要求總結

### 第六題：Testing（測試）

作業要求使用提供的測試腳本 `run-tests` 來測試你的 Mini-Python 解釋器實作。

## 測試結構

你的專案包含以下測試相關檔案：

```
mini-python/
├── run-tests          # 測試執行腳本
├── tests/
│   ├── good/         # 正向測試（應該成功執行的程式）
│   └── bad/          # 負向測試（應該報錯的程式）
```

### 測試類型說明

1. **Positive Tests（正向測試）** - `tests/good/`
   - 包含 35 個測試案例
   - 這些是應該能正確執行的 Python 程式
   - 每個 `.py` 檔案都有對應的 `.out` 檔案（預期輸出）
   - 測試類別包括：
     - `arith*.py` - 算術運算測試
     - `bool*.py` - 布林運算測試
     - `list*.py` - 列表操作測試
     - `range*.py` - range 函數測試
     - `loop*.py` - 迴圈測試
     - `fib.py`, `pascal.py`, `primes1.py` - 演算法測試
     - `mandelbrot.py` - 複雜計算測試

2. **Negative Tests（負向測試）** - `tests/bad/`
   - 包含 7 個測試案例
   - 這些程式應該產生錯誤
   - 你的解釋器應該：
     - 返回非零退出碼
     - 輸出以 `error:` 開頭的錯誤訊息

## 如何執行測試

### 方法一：使用測試腳本（推薦）

在專案根目錄執行：

```bash
cd mini-python
bash run-tests ./minipython.exe
```

### 方法二：在 Windows PowerShell 或 CMD 中

```cmd
cd mini-python
bash run-tests ./minipython.exe
```

**注意**：需要安裝 Git Bash 或 WSL 來執行 bash 腳本。

### 測試輸出說明

測試腳本會顯示：
- 每個測試檔案的名稱
- 失敗的測試會顯示 `FAIL` 訊息
- 最後顯示總分：`Score: X / Y tests (Z%)`

## 測試結果

**最新測試結果：通過所有測試！**

```
Score: 42 / 42 tests (100%)
```

- ✅ 35 個正向測試全部通過
- ✅ 7 個負向測試全部通過
- ✅ 總通過率：100%

## 手動測試單一檔案

如果想單獨測試某個檔案：

```bash
# 測試正向案例
./minipython.exe tests/good/arith1.py

# 比較輸出
./minipython.exe tests/good/arith1.py > out
diff out tests/good/arith1.out

# 測試負向案例（應該報錯）
./minipython.exe tests/bad/add1.py
```

## 查看測試案例內容

你可以查看任何測試檔案來了解它在測試什麼：

```bash
# 查看測試程式
cat tests/good/arith1.py

# 查看預期輸出
cat tests/good/arith1.out
```

### 常見測試案例範例

**算術運算** (`tests/good/arith1.py`):
```python
print(1 + 2 * 3)
print((1 + 2) * 3)
```

**迴圈與列表** (`tests/good/loop1.py`):
```python
for i in [1, 2, 3]:
    print(i)
```

**Range 函數** (`tests/good/range1.py`):
```python
for i in range(5):
    print(i)
```

**錯誤案例** (`tests/bad/add1.py`):
```python
print(1 + True)  # 應該報錯：型別不匹配
```

## 測試腳本工作原理

`run-tests` 腳本的運作方式：

1. **正向測試**：
   - 執行每個 `tests/good/*.py` 檔案
   - 將輸出重定向到 `out` 檔案
   - 與對應的 `.out` 檔案比較
   - 如果完全匹配，測試通過

2. **負向測試**：
   - 執行每個 `tests/bad/*.py` 檔案
   - 檢查程式是否返回錯誤（非零退出碼）
   - 檢查輸出是否包含 `error:` 字樣
   - 如果兩者都滿足，測試通過

## 除錯建議

如果某個測試失敗：

1. **查看差異**：
   ```bash
   ./minipython.exe tests/good/xxx.py > out
   diff out tests/good/xxx.out
   ```

2. **手動執行**：
   ```bash
   ./minipython.exe tests/good/xxx.py
   ```

3. **檢查錯誤訊息**：
   - 確保負向測試輸出以 `error:` 開頭
   - 檢查 `interp.ml` 中的錯誤處理

## 第七題及之後（Bonus）

作業可能包含額外的加分項目，例如：
- 實作更多 Python 功能
- 改進錯誤訊息
- 效能優化
- 額外的測試案例

請參考 assignment02.pdf 獲取完整的加分項目說明。

## 總結

恭喜！你的 Mini-Python 解釋器已經通過所有測試！

- ✅ 第 1-5 題：核心功能實作（已完成）
- ✅ 第 6 題：測試（100% 通過）
- 📋 第 7 題：Bonus 項目（選做）

你的實作已經滿足所有基本要求，可以準備提交作業了！
