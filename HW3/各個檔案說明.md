# HW3 檔案說明

本文件說明 HW3 中各個檔案的用途及其對應的題目。
---
此份作業前三題由我看作業翻譯後寫完
但我第四題到第六題有使用claude code
---

## 📁 主要實作文件

### `Parser.ml`
**對應題目：第 1~6 題（完整實作）**

這是最核心的文件，包含所有題目的解答：

#### 第 1 題 - `null` 函數 (行 13-28)
- **功能**：判斷正則表達式是否接受空字串 (epsilon)
- **實作重點**：
  - `Epsilon` → `true`
  - `Character` → `false`
  - `Union` → 只要有一個接受就是 `true`
  - `Concat` → 兩個都要接受才是 `true`
  - `Star` → 一定是 `true`（可以匹配 0 次）

#### 第 2 題 - `first` 和 `last` 函數 (行 31-62)
- **功能**：
  - `first`: 計算可能的首字符集合
  - `last`: 計算可能的尾字符集合
- **使用**：這兩個函數是構建 DFA 的基礎

#### 第 3 題 - `follow` 函數 (行 67-93)
- **功能**：計算在正則表達式中，哪些字符可以跟隨在給定字符 `c` 後面
- **重點**：
  - `Concat(r1, r2)`: 如果 `c ∈ last(r1)`，則 `first(r2)` 的字符可以跟隨
  - `Star(r1)`: 如果 `c ∈ last(r1)`，則 `first(r1)` 的字符可以跟隨（循環）

#### 第 4 題 - DFA 自動機構建 (行 154-251)
- **類型定義** (行 154-164):
  - `state`: 狀態是字符集合
  - `autom`: 自動機結構，包含起始狀態和轉移表
  - `Cmap`, `Smap`: 字符和狀態的 Map

- **`next_state` 函數** (行 168-175):
  - 計算從狀態 `q` 讀取字符 `c` 後的下一個狀態

- **`make_dfa` 函數** (行 178-221):
  - 從正則表達式構建完整的 DFA
  - 使用深度優先搜索遍歷所有可達狀態

- **可視化函數** (行 220-251):
  - `fprint_state`: 格式化輸出狀態
  - `fprint_transition`: 格式化輸出轉移
  - `fprint_autom`: 生成 Graphviz dot 格式
  - `save_autom`: 保存到文件

#### 第 5 題 - `recognize` 函數 (行 254-273)
- **功能**：判斷字串是否被自動機接受
- **實作**：模擬 DFA 運行，逐字符讀取並轉移狀態

#### 第 6 題 - `generate` 函數 (行 348-470)
- **功能**：生成 OCaml 詞法分析器代碼
- **生成內容**：
  - `buffer` 類型定義
  - `next_char` 函數
  - 每個狀態對應的 `stateN` 函數
  - `start` 起始狀態

---

## 🧪 測試相關文件

### `test_null()`, `test_first()`, `test_last()`, `test_follow()` (Parser.ml 行 96-149)
- **對應題目**：第 1~3 題
- **內容**：驗證 `null`, `first`, `last`, `follow` 函數的正確性

### `test_make_dfa()` (Parser.ml 行 276-287)
- **對應題目**：第 4 題
- **測試表達式**：`(a|b)*a(a|b)` - 倒數第二個字符是 a 的字串
- **輸出**：`autom.dot` 文件

### `test_recognize()` (Parser.ml 行 290-316)
- **對應題目**：第 5 題
- **測試表達式**：`(a|b)*a(a|b)`
- **測試內容**：
  - 正面測試：`"aa"`, `"ab"`, `"abababaab"`, `"babababab"`, 1000個b+`"ab"`
  - 負面測試：`""`, `"a"`, `"b"`, `"ba"`, `"aba"`, `"abababaaba"`

### `test_recognize2()` (Parser.ml 行 319-343)
- **對應題目**：第 5 題
- **測試表達式**：偶數個 b 的正則表達式
- **輸出**：`autom2.dot` 文件

### `test_generate()` (Parser.ml 行 427-431)
- **對應題目**：第 6.1 題
- **測試表達式**：`a*b`
- **輸出**：`a.ml` - 自動生成的詞法分析器

---

## 📊 自動機可視化文件

### `autom.dot` + `autom.pdf`
- **對應題目**：第 4 題
- **內容**：`(a|b)*a(a|b)` 的 DFA 圖形
- **生成方式**：
  ```bash
  wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml Parser.ml"
  wsl bash -c "cd /mnt/f/CompilerHW/HW3 && dot -Tpdf autom.dot > autom.pdf"
  ```
- **特點**：
  - 矩形節點：起始狀態
  - 橢圓節點：普通狀態
  - 包含 `#` 的狀態：接受狀態
  - 空橢圓：終止狀態

### `autom2.dot` + `autom2.pdf`
- **對應題目**：第 5 題
- **內容**：偶數個 b 的正則表達式的 DFA 圖形
- **生成方式**：由 `test_recognize2()` 自動生成

---

## 🔧 自動生成的詞法分析器

### `a.ml`
- **對應題目**：第 6.1 題
- **正則表達式**：`a*b`
- **生成方式**：由 `generate` 函數自動生成
- **內容**：
  ```ocaml
  type buffer = { ... }
  let next_char b = ...
  let rec state0 b = ...  (* 非接受狀態 *)
  and state1 b = ...      (* 接受狀態，包含 # *)
  let start = state0
  ```

### `alternating.ml`
- **對應題目**：第 6 題擴展
- **正則表達式**：`(b|ε)(ab)*(a|ε)` - 交替 a 和 b 的字串
- **生成方式**：由 `test_alternating.ml` 生成
- **特點**：可以識別空字串

---

## 🧑‍💻 測試程序

### `lexer.ml`
- **對應題目**：第 6.2 題
- **功能**：測試 `a.ml` 生成的詞法分析器
- **使用方式**：
  ```bash
  wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml lexer.ml <輸入字串>"
  ```
- **測試範例**：

  **成功案例** (`abbaaab`):
  ```
  --> "ab"
  --> "b"
  --> "aaab"
  Success
  ```

  **部分成功** (`aba`):
  ```
  --> "ab"
  Success
  ```

  **詞法錯誤** (`aac`):
  ```
  exception Failure("lexical error")
  ```

### `lexer_alt.ml`
- **對應題目**：第 6 題擴展
- **功能**：測試 `alternating.ml` 生成的詞法分析器
- **使用方式**：
  ```bash
  wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml lexer_alt.ml <輸入字串>"
  ```
- **測試範例** (`abbac`):
  ```
  --> "ab"
  --> "ba"
  --> ""
  would now loop
  ```
  （空字串會導致無限循環，所以程序停止）

### `test_alternating.ml`
- **對應題目**：第 6 題輔助
- **功能**：生成 `alternating.ml`
- **使用方式**：
  ```bash
  wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml test_alternating.ml"
  ```

---

## 📚 文檔文件

### `README.md`
- **內容**：作業的完整說明（從 PDF 轉換而來）
- **包含**：每一題的題目描述、測試案例、範例代碼

### `assignment03.pdf`
- **內容**：原始作業 PDF
- **來源**：老師提供的作業說明

---

## 📋 執行順序建議

1. **運行主程序**（測試所有題目）：
   ```bash
   wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml Parser.ml"
   ```
   這會運行所有測試並生成 `autom.dot`, `autom2.dot`, `a.ml`

2. **生成可視化圖片**（需要先安裝 Graphviz）：
   ```bash
   wsl bash -c "cd /mnt/f/CompilerHW/HW3 && dot -Tpdf autom.dot > autom.pdf"
   wsl bash -c "cd /mnt/f/CompilerHW/HW3 && dot -Tpdf autom2.dot > autom2.pdf"
   ```

3. **測試詞法分析器**：
   ```bash
   # 測試 a*b
   wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml lexer.ml abbaaab"

   # 測試交替 a/b
   wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml test_alternating.ml"
   wsl bash -c "cd /mnt/f/CompilerHW/HW3 && ocaml lexer_alt.ml abbac"
   ```

---

## 🎯 題目總覽表

| 題目 | 函數/功能 | 主要文件 | 輸出文件 | 測試文件 |
|------|-----------|----------|----------|----------|
| 1 | `null` | Parser.ml (13-28) | - | Parser.ml (96-104) |
| 2 | `first`, `last` | Parser.ml (31-62) | - | Parser.ml (107-130) |
| 3 | `follow` | Parser.ml (67-93) | - | Parser.ml (132-148) |
| 4.1 | `next_state` | Parser.ml (168-175) | - | - |
| 4.2 | `make_dfa` | Parser.ml (178-221) | autom.dot | Parser.ml (276-287) |
| 4 | 可視化 | Parser.ml (220-251) | autom.pdf | - |
| 5 | `recognize` | Parser.ml (254-273) | autom2.dot | Parser.ml (290-343) |
| 6.1 | `generate` | Parser.ml (348-470) | a.ml | Parser.ml (427-431) |
| 6.2 | 詞法分析器 | lexer.ml | - | 手動測試 |
| 擴展 | 交替 a/b | test_alternating.ml | alternating.ml | lexer_alt.ml |

---

## ✅ 完成狀態

- ✅ **第 1 題**：`null` 函數 - 所有測試通過
- ✅ **第 2 題**：`first`, `last` 函數 - 所有測試通過
- ✅ **第 3 題**：`follow` 函數 - 所有測試通過
- ✅ **第 4 題**：DFA 構建 + 可視化 - 生成的圖形與老師範例一致
- ✅ **第 5 題**：`recognize` 函數 - 所有測試通過
- ✅ **第 6 題**：詞法分析器生成 - 所有測試通過

**所有功能完整實作，所有測試通過！** 🎉
