# Mini-Java ç·¨è­¯å™¨å°ˆæ¡ˆè¦æ ¼èªªæ˜Ž

## å°ˆæ¡ˆæ¦‚è¿°

**èª²ç¨‹**: 337883 Compiler (114-1)
**ç‰ˆæœ¬**: 1.0 - 2025å¹´11æœˆ3æ—¥
**ç¹³äº¤æœŸé™**: 2026å¹´1æœˆ9æ—¥

æœ¬å°ˆæ¡ˆç›®æ¨™æ˜¯ç‚º Java èªžè¨€çš„ä¸€å€‹å°åž‹å­é›†ï¼ˆç¨±ç‚º Mini-Javaï¼‰å»ºç«‹ç·¨è­¯å™¨ (compiler)ï¼Œå°‡ç¨‹å¼ç¢¼ç·¨è­¯æˆ x86-64 çµ„åˆèªžè¨€ (assembly)ã€‚

## å°ˆæ¡ˆè¦æ±‚

ä½ éœ€è¦å¯¦ä½œä»¥ä¸‹å…©å€‹éƒ¨åˆ†ï¼š
- âœ… **èªžæ³•åˆ†æžå™¨ (Parser)**: å·²æä¾›ï¼ˆåƒ…é™ OCamlï¼‰
- ðŸ“ **éœæ…‹åž‹åˆ¥æª¢æŸ¥ (Static Type Checking)**: éœ€è¦å¯¦ä½œ
- ðŸ”§ **ç¨‹å¼ç¢¼ç”¢ç”Ÿ (Code Generation)**: éœ€è¦å¯¦ä½œ

## Mini-Java èªžè¨€ç‰¹æ€§

Mini-Java æ”¯æ´ä»¥ä¸‹ç‰¹æ€§ï¼š
- **åŸºæœ¬åž‹åˆ¥ (Primitive Types)**: `int`ã€`boolean`
- **åƒè€ƒåž‹åˆ¥ (Reference Types)**: ç‰©ä»¶ (objects)ã€å­—ä¸² (strings)
- **ç‰©ä»¶å°Žå‘ (Object-Oriented)**: é¡žåˆ¥ (class)ã€ç¹¼æ‰¿ (inheritance)ã€å»ºæ§‹å­ (constructor)ã€æ–¹æ³• (method)
- **æŽ§åˆ¶æµç¨‹ (Control Flow)**: `if-else`ã€`for` è¿´åœˆ (loop)
- **é‹ç®—å¼ (Expression)**: ç®—è¡“é‹ç®—ã€é‚è¼¯é‹ç®—ã€æ¯”è¼ƒé‹ç®—ã€åž‹åˆ¥è½‰æ› (cast)ã€`instanceof`

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šèªžæ³•è¦ç¯„ (Syntax)

### 1.1 è©žæ³•æ…£ä¾‹ (Lexical Conventions)

#### é—œéµå­— (Keywords)
```
boolean  class  else  extends  false  for  if
instanceof  int  new  null  public  return  static
this  true  void
```

#### è­˜åˆ¥å­— (Identifier)
- æ­£è¦è¡¨ç¤ºå¼ (regular expression): `(å­—æ¯ | _)(å­—æ¯ | _ | æ•¸å­—)*`
- å¤§å°å¯«æ•æ„Ÿ (case-sensitive)

#### å­—é¢å€¼ (Literal)
- **æ•´æ•¸ (integer)**: `0` æˆ– `1-9 æ•¸å­—*`
- **å­—ä¸² (string)**: é›™å¼•è™ŸåŒ…åœï¼Œæ”¯æ´è·³è„«åºåˆ— (escape sequence) `\"`ã€`\n`ã€`\\`
- **å¸ƒæž—å€¼ (boolean)**: `true`ã€`false`

#### è¨»è§£ (Comment)
- å–®è¡Œè¨»è§£: `//` ç›´åˆ°è¡Œå°¾
- å¤šè¡Œè¨»è§£: `/* ... */`ï¼ˆä¸æ”¯æ´å·¢ç‹€ nestedï¼‰

### 1.2 èªžæ³•çµæ§‹ (Grammar)

#### æª”æ¡ˆçµæ§‹ (File Structure)
```
âŸ¨fileâŸ© ::= âŸ¨classâŸ©* âŸ¨class_MainâŸ© EOF
```

æ¯å€‹ Mini-Java ç¨‹å¼å¿…é ˆåŒ…å«ä¸€å€‹ `Main` é¡žåˆ¥ï¼š
```java
class Main {
    public static void main(String args[]) {
        // é™³è¿°å¼ (statements)
    }
}
```

#### é¡žåˆ¥å®£å‘Š (Class Declaration)
```
âŸ¨classâŸ© ::= class âŸ¨identâŸ© (extends âŸ¨identâŸ©)? { âŸ¨declâŸ©* }
âŸ¨declâŸ©  ::= âŸ¨typeâŸ© âŸ¨identâŸ© ; | âŸ¨constructorâŸ© | âŸ¨methodâŸ©
```

#### å»ºæ§‹å­ (Constructor) èˆ‡æ–¹æ³• (Method)
```
âŸ¨constructorâŸ© ::= âŸ¨identâŸ© ( âŸ¨paramsâŸ©? ) { âŸ¨stmtâŸ©* }
âŸ¨methodâŸ©      ::= ( âŸ¨typeâŸ© | void ) âŸ¨identâŸ© ( âŸ¨paramsâŸ©? ) { âŸ¨stmtâŸ©* }
```

#### é‹ç®—å­å„ªå…ˆé †åº (Operator Precedence)

| é‹ç®—å­ (Operator) | çµåˆæ€§ (Associativity) | å„ªå…ˆé †åº (Priority) |
|--------|--------|--------|
| `=` | å³çµåˆ (right) | æœ€ä½Ž (lowest) |
| `\|\|` | å·¦çµåˆ (left) | â†‘ |
| `&&` | å·¦çµåˆ (left) | â†‘ |
| `==`, `!=` | å·¦çµåˆ (left) | â†‘ |
| `>`, `>=`, `<`, `<=`, `instanceof` | å·¦çµåˆ (left) | â†‘ |
| `+`, `-` | å·¦çµåˆ (left) | â†‘ |
| `*`, `/`, `%` | å·¦çµåˆ (left) | â†‘ |
| `-`(ä¸€å…ƒ unary), `!`, cast | å³çµåˆ (right) | â†‘ |
| `.` | å·¦çµåˆ (left) | æœ€é«˜ (strongest) |

#### èªžæ³•ç³– (Syntactic Sugar)
- `if (e1) e2` ç­‰åŒæ–¼ `if (e1) e2 else {}`
- `m(e1,...,en)` ç­‰åŒæ–¼ `this.m(e1,...,en)`
- `for` è¿´åœˆä¸­çœç•¥çš„æ¢ä»¶å¼é è¨­ç‚º `true`

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šéœæ…‹åž‹åˆ¥æª¢æŸ¥ (Static Typing)

### 2.1 åž‹åˆ¥ç³»çµ± (Type System)

#### éœæ…‹åž‹åˆ¥ (Static Types)
```
Ï„ ::= void | boolean | int | C | typenull
```

å…¶ä¸­ï¼š
- `C`: é¡žåˆ¥åž‹åˆ¥ (class type)
- `typenull`: null çš„åž‹åˆ¥
- é å®šç¾©é¡žåˆ¥ (predefined classes): `Object`ã€`String`

#### ç¹¼æ‰¿èˆ‡å­åž‹åˆ¥ (Inheritance and Subtyping)

**å­åž‹åˆ¥é—œä¿‚ (subtyping relation)** Ï„â‚ âŠ‘ Ï„â‚‚ è¡¨ç¤ºã€Œåž‹åˆ¥ Ï„â‚ æ˜¯åž‹åˆ¥ Ï„â‚‚ çš„å­åž‹åˆ¥ã€ï¼š

1. **åŸºæœ¬åž‹åˆ¥**: `boolean âŠ‘ boolean`ã€`int âŠ‘ int`
2. **é¡žåˆ¥ç¹¼æ‰¿**: è‹¥ `Câ‚ â†’ Câ‚‚`ï¼ˆCâ‚ ç¹¼æ‰¿è‡ª Câ‚‚ï¼‰ï¼Œå‰‡ `Câ‚ âŠ‘ Câ‚‚`
3. **null**: `typenull âŠ‘ C`ï¼ˆå°ä»»æ„é¡žåˆ¥ Cï¼‰

#### åž‹åˆ¥å…¼å®¹æ€§ (Type Compatibility)
Ï„â‚ â‰¡ Ï„â‚‚ ç•¶ä¸”åƒ…ç•¶ Ï„â‚ âŠ‘ Ï„â‚‚ æˆ– Ï„â‚‚ âŠ‘ Ï„â‚

### 2.2 é‹ç®—å¼çš„åž‹åˆ¥è¦å‰‡ (Type Rules for Expressions)

åž‹åˆ¥ç’°å¢ƒ (typing environment) Î“ æ˜¯è®Šæ•¸å®£å‘Š (variable declarations) çš„åºåˆ—ã€‚

åˆ¤æ–·å¼ (judgment) `Î“ âŠ¢ e : Ï„` è¡¨ç¤ºã€Œåœ¨ç’°å¢ƒ Î“ ä¸­ï¼Œé‹ç®—å¼ e çš„åž‹åˆ¥æ˜¯ Ï„ã€ã€‚

**é—œéµè¦å‰‡**ï¼š
- å¸¸æ•¸ (constants) æœ‰å›ºå®šåž‹åˆ¥
- `null` çš„åž‹åˆ¥æ˜¯ `typenull`
- æ–¹æ³•å‘¼å« (method call) éœ€è¦åƒæ•¸åž‹åˆ¥åŒ¹é…ï¼ˆæ”¯æ´å­åž‹åˆ¥ï¼‰
- è³¦å€¼ (assignment) è¦æ±‚å³å´åž‹åˆ¥æ˜¯å·¦å´çš„å­åž‹åˆ¥
- äºŒå…ƒé‹ç®—å­ (binary operators) éœ€è¦é‹ç®—å…ƒ (operands) åž‹åˆ¥åŒ¹é…

### 2.3 é™³è¿°å¼çš„åž‹åˆ¥è¦å‰‡ (Typing Rules for Statements)

åˆ¤æ–·å¼ `Î“ âŠ¢ s â†’ Î“'` è¡¨ç¤ºã€Œé™³è¿°å¼ s åœ¨ç’°å¢ƒ Î“ ä¸‹åž‹åˆ¥æ­£ç¢ºï¼Œç”¢ç”Ÿæ–°ç’°å¢ƒ Î“'ã€ã€‚

**é—œéµè¦å‰‡**ï¼š
- è®Šæ•¸å®£å‘Š (variable declaration) æ·»åŠ åˆ°ç’°å¢ƒä¸­
- if æ¢ä»¶å¿…é ˆæ˜¯ `boolean` åž‹åˆ¥
- for è¿´åœˆçš„æ¢ä»¶å¿…é ˆæ˜¯ `boolean` åž‹åˆ¥
- return é™³è¿°å¼ (statement) çš„åž‹åˆ¥å¿…é ˆèˆ‡æ–¹æ³•å›žå‚³åž‹åˆ¥ (return type) å…¼å®¹

### 2.4 é¡žåˆ¥çš„åž‹åˆ¥è¦å‰‡ (Typing Rules for Classes)

#### å­˜åœ¨æ€§èˆ‡å”¯ä¸€æ€§ (Existence and Uniqueness)

ç¨‹å¼æª”æ¡ˆå¿…é ˆæ»¿è¶³ä»¥ä¸‹é™åˆ¶ï¼š
1. æ¯å€‹é¡žåˆ¥åªèƒ½å®šç¾©ä¸€æ¬¡
2. é¡žåˆ¥å¿…é ˆç¹¼æ‰¿è‡ªå­˜åœ¨çš„é¡žåˆ¥ï¼ˆä¸”ä¸èƒ½ç¹¼æ‰¿ Stringï¼‰
3. ç¹¼æ‰¿é—œä¿‚ä¸èƒ½æœ‰å¾ªç’° (cycle)
4. é¡žåˆ¥çš„å±¬æ€§ (attributes) åç¨±å¿…é ˆä¸åŒ
5. æ¯å€‹é¡žåˆ¥æœ€å¤šä¸€å€‹å»ºæ§‹å­ï¼ˆç„¡é‡è¼‰ overloadingï¼‰
6. æ¯å€‹é¡žåˆ¥ä¸­æ–¹æ³•åç¨±ä¸èƒ½é‡è¤‡ï¼ˆç„¡é‡è¼‰ï¼‰

#### æ–¹æ³•è¦†å¯« (Method Overriding)
å¦‚æžœæ–¹æ³• `m` åœ¨é¡žåˆ¥ `C` ä¸­è¢«è¦†å¯« (overridden)ï¼Œå‰‡åƒæ•¸åž‹åˆ¥å’Œå›žå‚³åž‹åˆ¥å¿…é ˆå®Œå…¨ç›¸åŒã€‚

#### å±¬æ€§ã€å»ºæ§‹å­ã€æ–¹æ³•çš„åž‹åˆ¥æª¢æŸ¥

**åž‹åˆ¥æª¢æŸ¥å±¬æ€§ (attributes)**ï¼šå±¬æ€§å®£å‘Šçš„åž‹åˆ¥ Ï„ å¿…é ˆæ˜¯è‰¯æ§‹çš„ (well-formed)ã€‚

**åž‹åˆ¥æª¢æŸ¥å»ºæ§‹å­**ï¼šå»ºæ§‹å­ `Câ‚€(Ï„â‚ xâ‚, ..., Ï„â‚™ xâ‚™) { s }` æ˜¯è‰¯å¥½åž‹åˆ¥åŒ–çš„ï¼Œè‹¥ï¼š
- è­˜åˆ¥å­— xi å…©å…©ä¸åŒ
- æ‰€æœ‰åž‹åˆ¥ Ï„i éƒ½æ˜¯è‰¯æ§‹çš„
- å€å¡Š (block) s åœ¨ç’°å¢ƒ `Î“â‚€, Ï„â‚ xâ‚, ..., Ï„â‚™ xâ‚™` ä¸­åž‹åˆ¥æ­£ç¢º

**åž‹åˆ¥æª¢æŸ¥æ–¹æ³•**ï¼šæ–¹æ³• `Ï„ m(Ï„â‚ xâ‚, ..., Ï„â‚™ xâ‚™) { s }` æ˜¯è‰¯å¥½åž‹åˆ¥åŒ–çš„ï¼Œè‹¥ï¼š
- è­˜åˆ¥å­— xi å…©å…©ä¸åŒ
- æ‰€æœ‰åž‹åˆ¥ Ï„i éƒ½æ˜¯è‰¯æ§‹çš„
- å€å¡Š s åœ¨ç’°å¢ƒ `Î“â‚€, Ï„â‚ xâ‚, ..., Ï„â‚™ xâ‚™` ä¸­åž‹åˆ¥æ­£ç¢º
- æ‰€æœ‰ return å›žå‚³çš„å€¼å¿…é ˆæ˜¯ Ï„ çš„å­åž‹åˆ¥
- è‹¥ Ï„ ä¸æ˜¯ voidï¼Œå‰‡æ‰€æœ‰åŸ·è¡Œè·¯å¾‘ (execution flow) éƒ½å¿…é ˆåŒ…å« return é™³è¿°å¼

### 2.5 å¯¦ä½œæç¤º (Hints)

å¼·çƒˆå»ºè­°åˆ†ä¸‰æ­¥é€²è¡Œï¼š
1. å®£å‘Šæ‰€æœ‰é¡žåˆ¥ä¸¦æª¢æŸ¥é¡žåˆ¥çš„å”¯ä¸€æ€§
2. å®£å‘Šç¹¼æ‰¿é—œä¿‚ (extends)ã€å±¬æ€§ã€å»ºæ§‹å­å’Œæ–¹æ³•
3. åž‹åˆ¥æª¢æŸ¥å»ºæ§‹å­å’Œæ–¹æ³•çš„ä¸»é«” (body)

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šç¨‹å¼ç¢¼ç”¢ç”Ÿ (Code Generation)

### 3.1 å€¼çš„è¡¨ç¤º (Value Representation)

æ‰€æœ‰å€¼éƒ½æ˜¯ 64 ä½å…ƒå­—çµ„ (64-bit word)ï¼š
- **null**: æ•´æ•¸ 0
- **int**: 64 ä½å…ƒæ•´æ•¸ï¼ˆé›–ç„¶ Java çš„ int æ˜¯ 32 ä½å…ƒï¼‰
- **boolean**: `false = 0`ã€`true = 1`
- **ç‰©ä»¶ (object)**: æŒ‡å‘å †ç© (heap) ä¸Šåˆ†é…å€å¡Šçš„æŒ‡æ¨™ (pointer)

### 3.2 ç‰©ä»¶ä½ˆå±€ (Object Layout)

#### ä¸€èˆ¬ç‰©ä»¶
```
+-------+----+----+-----+----+
| class | v1 | v2 | ... | vn |
+-------+----+----+-----+----+
```
- ç¬¬ä¸€å€‹å­—çµ„: æŒ‡å‘é¡žåˆ¥æè¿°å­ (class descriptor) çš„æŒ‡æ¨™
- å…¶é¤˜å­—çµ„: å±¬æ€§å€¼ (attribute values)

**é‡è¦**ï¼šå±¬æ€§çš„çµ„ç¹”æ–¹å¼ä½¿å¾—é¡žåˆ¥ C çš„å±¬æ€§ x åœ¨ç‰©ä»¶ä¸­çš„åç§»é‡ (offset)ï¼Œèˆ‡ C çš„ä»»ä½•å­é¡žåˆ¥ä¸­çš„åç§»é‡ç›¸åŒï¼ˆå› ç‚º Java åªæœ‰å–®ä¸€ç¹¼æ‰¿ single inheritanceï¼‰ã€‚

#### ç¯„ä¾‹ï¼šç¹¼æ‰¿ä¸­çš„å±¬æ€§ä½ˆå±€
```java
class A { int x; boolean b; }
class B extends A { int d; }
```

ç‰©ä»¶ä½ˆå±€ï¼š
```
A: | class | x | b |
B: | class | x | b | d |
```

#### å­—ä¸²ç‰©ä»¶ (String Object)
```
+--------+----------------------+
| String | 0-terminated string  |
+--------+----------------------+
```
- ç¬¬ä¸€å€‹å­—çµ„: æŒ‡å‘ String é¡žåˆ¥æè¿°å­
- å…¶é¤˜ n+1 ä½å…ƒçµ„: ä»¥ '\0' çµå°¾çš„ ASCII å­—ä¸²

### 3.3 é¡žåˆ¥æè¿°å­ (Class Descriptor)

æ¯å€‹é¡žåˆ¥åœ¨è³‡æ–™å€æ®µ (data segment) æœ‰ä¸€å€‹éœæ…‹åˆ†é…çš„æè¿°å­ï¼š
```
+--------+------+------+-----+
| parent | m1   | m2   | ... |
+--------+------+------+-----+
```
- ç¬¬ä¸€å€‹å­—çµ„: çˆ¶é¡žåˆ¥æè¿°å­æŒ‡æ¨™
- å…¶é¤˜å­—çµ„: æ–¹æ³•ç¨‹å¼ç¢¼ä½å€ (method code addresses)

**å‰ç¶´è¦å‰‡ (prefix rule)**ï¼šå­é¡žåˆ¥çš„æ–¹æ³•è¡¨ (method table) å¿…é ˆä¿æŒçˆ¶é¡žåˆ¥æ–¹æ³•çš„åç§»é‡ä¸è®Šã€‚

#### ç¯„ä¾‹ï¼šæ–¹æ³•è¦†å¯«ä¸­çš„æè¿°å­ä½ˆå±€
```java
class A { int f() {...} boolean g() {...} }
class B extends A { int f() {...} boolean h() {...} }
```

é¡žåˆ¥æè¿°å­ï¼š
```
A: | Object | A_f | A_g |
B: | A      | B_f | A_g | B_h |
```

### 3.4 åž‹åˆ¥è½‰æ›èˆ‡ instanceof (Cast and instanceof)

ç•¶ç„¡æ³•éœæ…‹è§£æžæ™‚ï¼Œå¿…é ˆåœ¨åŸ·è¡ŒæœŸ (runtime) åŸ·è¡Œï¼š
- ä½¿ç”¨ç‰©ä»¶ä¸­çš„é¡žåˆ¥æè¿°å­æŒ‡æ¨™
- æ²¿è‘—ç¹¼æ‰¿éˆå‘ä¸ŠæŸ¥æ‰¾
- è‹¥åˆ°é” Object ä»æœªæ‰¾åˆ°é æœŸé¡žåˆ¥ï¼š
  - cast å¤±æ•—ï¼šè¼¸å‡º "cast failure" ä¸¦ä»¥é€€å‡ºç¢¼ (exit code) 1 çµæŸ
  - instanceof å›žå‚³ false
- **æ³¨æ„**ï¼šå¿…é ˆå…ˆæª¢æŸ¥ç‰©ä»¶æ˜¯å¦ç‚º null

### 3.5 å †ç–Šä½ˆå±€ (Stack Layout)

å»ºè­°çš„ç·¨è­¯æ–¹æ¡ˆï¼š
- `this` å’Œæ‰€æœ‰åƒæ•¸ (parameters) é€éŽå †ç–Š (stack) å‚³éžï¼ˆæ¯å€‹ 64 ä½å…ƒå­—çµ„ï¼‰
- å›žå‚³å€¼ (return value) æ”¾åœ¨æš«å­˜å™¨ (register) `%rax`

#### å †ç–Šæ¡†æž¶ (Stack Frame)
```
+------------------+
| parameter n      |
| ...              |
| parameter 1      |
| return address   |
+------------------+
| saved %rbp       | <- %rbp
| local variables  |
| ...              |
| temporary values |
| ...              | <- %rsp
+------------------+
```

å€åŸŸè®Šæ•¸ (local variables) åˆ†é…åœ¨å †ç–Šä¸Šã€‚å †ç–Šé ‚ç«¯ç”¨æ–¼å„²å­˜ä¸­é–“è¨ˆç®—çµæžœ (intermediate computations)ã€‚

### 3.6 å †ç–Šå°é½Š (Stack Alignment)

**é‡è¦**ï¼šå‘¼å« libc å‡½å¼æ™‚éœ€è¦ 16 ä½å…ƒçµ„å †ç–Šå°é½Šï¼ˆSystem V ABI è¦æ±‚ï¼‰ã€‚

å»ºè­°ç‚ºå‡½å¼åº«å‡½å¼å»ºç«‹åŒ…è£å™¨ (wrappers)ï¼š

```asm
my_malloc:
    pushq %rbp
    movq %rsp, %rbp
    andq $-16, %rsp      # 16-byte å †ç–Šå°é½Š
    call malloc
    movq %rbp, %rsp
    popq %rbp
    ret
```

### 3.7 C æ¨™æº–å‡½å¼åº« (C Standard Library)

ä½ å¯èƒ½éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‡½å¼ï¼š

#### è¨˜æ†¶é«”ç®¡ç† (Memory Management)
```c
void *malloc(size_t size);
```
- åˆ†é… size ä½å…ƒçµ„çš„å †ç©è¨˜æ†¶é«”
- ä¸éœ€è¦é‡‹æ”¾è¨˜æ†¶é«” (free)

#### è¼¸å…¥è¼¸å‡º (I/O)
```c
int printf(const char *format, ...);
int sprintf(char *s, const char *format, ...);
```
- **é‡è¦**ï¼šå‘¼å«å‰å¿…é ˆè¨­å®š `%rax = 0`

#### å­—ä¸²æ“ä½œ (String Operations)
```c
int strlen(const char *s);              // å­—ä¸²é•·åº¦
int strcmp(const char *s1, const char *s2);  // å­—ä¸²æ¯”è¼ƒ
char *strcpy(char *dest, const char *src);   // å­—ä¸²è¤‡è£½
char *strcat(char *dest, const char *src);   // å­—ä¸²é€£æŽ¥
```

#### ç¨‹å¼çµ‚æ­¢ (Program Termination)
```c
void exit(int n);
```

### 3.8 å¯¦ä½œæç¤º

å»ºè­°åˆ†ä¸‰æ­¥é€²è¡Œï¼š
1. å»ºç«‹é¡žåˆ¥æè¿°å­ (class descriptors)
2. è¨­å®šå±¬æ€§åç§»é‡ï¼ˆç‰©ä»¶å…§ï¼‰å’Œå€åŸŸè®Šæ•¸åç§»é‡ï¼ˆå †ç–Šä¸Šï¼‰
3. ç·¨è­¯æ–¹æ³•å’Œå»ºæ§‹å­çš„ä¸»é«”ç¨‹å¼ç¢¼

---

## ç¬¬å››éƒ¨åˆ†ï¼šå°ˆæ¡ˆç¹³äº¤ (Project Assignment)

### 4.1 å¯¦ä½œæ–¹å¼

- å¯ä½¿ç”¨ **OCaml**ï¼ˆæä¾› parserï¼‰æˆ–**ä»»ä½•å…¶ä»–èªžè¨€**
- å¯**å–®ç¨å®Œæˆ**æˆ–**å…©äººä¸€çµ„**

### 4.2 ç¹³äº¤å…§å®¹

åœ¨ i-school ç¹³äº¤ä¸€å€‹å£“ç¸®æª”ï¼ŒåŒ…å«ä»¥ä½ çš„åå­—å‘½åçš„ç›®éŒ„ï¼ˆä¾‹å¦‚ `JyunAo-Kat/`ï¼‰ï¼Œå…§å«ï¼š

#### 1. ç·¨è­¯å™¨åŽŸå§‹ç¢¼ (Source Code)
- æ‰€æœ‰åŽŸå§‹æª”
- ä¸éœ€åŒ…å«ç·¨è­¯å¾Œçš„æª”æ¡ˆ

#### 2. Makefile
- åŸ·è¡Œ `make` å¿…é ˆç”¢ç”Ÿåç‚º `minijava` çš„ç·¨è­¯å™¨
- å¯ä»¥ä½¿ç”¨ä»»ä½•å»ºç½®å·¥å…·ï¼ˆå¦‚ OCaml çš„ duneï¼‰

#### 3. ç°¡çŸ­å ±å‘Š (Report)
èªªæ˜Žä»¥ä¸‹å…§å®¹ï¼š
- æŠ€è¡“é¸æ“‡ (technical choices)
- é‡åˆ°çš„å•é¡Œ (issues)
- æœªå®Œæˆçš„åŠŸèƒ½åˆ—è¡¨
- æ ¼å¼ï¼š**ASCII**ã€**Markdown** æˆ– **PDF**

### 4.3 ç·¨è­¯å™¨å‘½ä»¤åˆ—ä»‹é¢ (Command-line Interface)

#### ä½¿ç”¨æ–¹å¼
```bash
minijava [--parse-only | --type-only] file.java
```

#### é¸é …èªªæ˜Ž

**`--parse-only`**
- åƒ…åŸ·è¡Œèªžæ³•åˆ†æž (parsing)
- æˆåŠŸï¼šé€€å‡ºç¢¼ 0
- å¤±æ•—ï¼šè¼¸å‡ºéŒ¯èª¤è¨Šæ¯ï¼Œé€€å‡ºç¢¼ 1

**`--type-only`**
- åŸ·è¡Œèªžæ³•åˆ†æž + åž‹åˆ¥æª¢æŸ¥
- æˆåŠŸï¼šé€€å‡ºç¢¼ 0
- å¤±æ•—ï¼šè¼¸å‡ºéŒ¯èª¤è¨Šæ¯ï¼Œé€€å‡ºç¢¼ 1

**ç„¡é¸é …ï¼ˆå®Œæ•´ç·¨è­¯ï¼‰**
- åŸ·è¡Œèªžæ³•åˆ†æž + åž‹åˆ¥æª¢æŸ¥ + ç¨‹å¼ç¢¼ç”¢ç”Ÿ
- æˆåŠŸï¼šç”¢ç”Ÿ `file.s` çµ„åˆèªžè¨€æª”æ¡ˆ
- å¤±æ•—ï¼šè¼¸å‡ºéŒ¯èª¤è¨Šæ¯ï¼Œé€€å‡ºç¢¼ 1

#### éŒ¯èª¤è¨Šæ¯æ ¼å¼ (Error Message Format)
```
file.java:4:6:
bad arity for method m
```

æ ¼å¼ï¼š`æª”æ¡ˆå:è¡Œè™Ÿ:æ¬„è™Ÿ:`

éŒ¯èª¤è¨Šæ¯å…§å®¹å¯è‡ªè¡Œè¨­è¨ˆï¼Œä½†å¿…é ˆåŒ…å«ä½ç½®è³‡è¨Šã€‚

### 4.4 åŸ·è¡Œç”¢ç”Ÿçš„ç¨‹å¼ç¢¼

ç·¨è­¯ä¸¦åŸ·è¡Œç”¢ç”Ÿçš„çµ„åˆèªžè¨€ï¼š
```bash
gcc file.s -o file
./file
```

å¯èƒ½éœ€è¦æ·»åŠ  `-no-pie` é¸é …ï¼š
```bash
gcc file.s -o file -no-pie
```

åŸ·è¡ŒæœŸéŒ¯èª¤ (runtime errors)ï¼š
- è¼¸å‡º `error` æˆ–å…¶ä»–éŒ¯èª¤è¨Šæ¯
- ä»¥é€€å‡ºç¢¼ 1 çµ‚æ­¢
- ä¸éœ€è¦æä¾›è©³ç´°çš„ä½ç½®æˆ–è¨Šæ¯

### 4.5 è©•åˆ†èªªæ˜Ž

**é‡è¦**ï¼šéƒ¨åˆ†è©•åˆ†åŸºæ–¼è‡ªå‹•åŒ–æ¸¬è©¦
- æ¸¬è©¦å°åž‹ Java ç¨‹å¼ï¼ˆåŒ…å« print é™³è¿°å¼ï¼‰
- æ¯”å°å¯¦éš›è¼¸å‡º (output) èˆ‡é æœŸè¼¸å‡º
- **å‹™å¿…æ­£ç¢ºå¯¦ä½œ print åŠŸèƒ½**

---

## é–‹ç™¼å»ºè­°

### é™¤éŒ¯æŠ€å·§ (Debugging Tips)
1. å¾žç°¡å–®çš„æ¸¬è©¦æ¡ˆä¾‹é–‹å§‹
2. é€æ­¥å¢žåŠ èªžè¨€ç‰¹æ€§
3. ä½¿ç”¨ Java ä½œç‚ºåƒè€ƒï¼ˆMini-Java èˆ‡ Java ç›¸å®¹ï¼‰
4. ä»”ç´°è™•ç†ç¹¼æ‰¿å’Œæ–¹æ³•è¦†å¯«

### æ¸¬è©¦ç­–ç•¥ (Testing Strategy)
- å»ºç«‹å°åž‹æ¸¬è©¦ç¨‹å¼
- æ¸¬è©¦æ¯å€‹èªžè¨€ç‰¹æ€§
- æ¯”å° Java å’Œ Mini-Java çš„è¼¸å‡º

### å¸¸è¦‹é™·é˜± (Common Pitfalls)
- å †ç–Šå°é½Šå•é¡Œ
- ç¹¼æ‰¿ä¸­çš„å±¬æ€§å’Œæ–¹æ³•åç§»é‡
- null è™•ç†
- åž‹åˆ¥è½‰æ›å’Œ instanceof çš„åŸ·è¡ŒæœŸæª¢æŸ¥

---

## å°ˆæ¡ˆæ™‚ç¨‹å»ºè­°

### ç¬¬ä¸€éšŽæ®µï¼šåž‹åˆ¥æª¢æŸ¥ï¼ˆ2é€±ï¼‰
1. å®£å‘Šæ‰€æœ‰é¡žåˆ¥
2. å»ºç«‹ç¹¼æ‰¿é—œä¿‚
3. å¯¦ä½œé‹ç®—å¼åž‹åˆ¥æª¢æŸ¥
4. å¯¦ä½œé™³è¿°å¼åž‹åˆ¥æª¢æŸ¥

### ç¬¬äºŒéšŽæ®µï¼šç¨‹å¼ç¢¼ç”¢ç”Ÿï¼ˆ3é€±ï¼‰
1. å»ºç«‹é¡žåˆ¥æè¿°å­
2. å¯¦ä½œç°¡å–®é‹ç®—å¼çš„ç¨‹å¼ç¢¼ç”¢ç”Ÿ
3. å¯¦ä½œæŽ§åˆ¶æµç¨‹
4. å¯¦ä½œæ–¹æ³•å‘¼å«
5. å¯¦ä½œç‰©ä»¶å»ºç«‹

### ç¬¬ä¸‰éšŽæ®µï¼šæ¸¬è©¦èˆ‡é™¤éŒ¯ï¼ˆ1é€±ï¼‰
1. å®Œæ•´æ¸¬è©¦
2. ä¿®æ­£éŒ¯èª¤
3. æœ€ä½³åŒ–ï¼ˆé¸æ“‡æ€§ï¼‰
4. æ’°å¯«å ±å‘Š

---

## åƒè€ƒè³‡æº

- **PDF è¦æ ¼æ–‡ä»¶**ï¼šåœ– 1-3 åŒ…å«å®Œæ•´èªžæ³•å’Œåž‹åˆ¥è¦å‰‡
- **Java ç·¨è­¯å™¨**ï¼šå¯ç”¨æ–¼é©—è­‰èªžç¾©
- **System V ABI è¦ç¯„**ï¼šx86-64 å‘¼å«æ…£ä¾‹ (calling convention)

---

## è¯çµ¡èˆ‡æ”¯æ´

å¦‚æœ‰å•é¡Œè«‹è¯çµ¡åŠ©æ•™æˆ–æ–¼èª²ç¨‹å¹³å°æå•ã€‚

**ç¹³äº¤æœŸé™**: 2026å¹´1æœˆ9æ—¥
**ç¹³äº¤å¹³å°**: i-school

ç¥ä½ å¯¦ä½œé †åˆ©ï¼ðŸš€
